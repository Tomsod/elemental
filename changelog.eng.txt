This is the change log for the Elemental Mod.  It's quite descriptive,
and can be viewed as the chief source of information on the mod's features.

== Elemental Mod ver. 4.0.1 ==

A tiny release that introduces a couple of sorely missing features and
fixes several bugs that came up while playtesting 4.0 on the forums.

* Added three kinds of "martial gauntlets" that go into the gloves slot and
  provide bonuses to unarmed damage, including possible temporary and/or
  permanent elemental/etc. enchantments.  Now Monks benefit from Fire Aura!
* On Medium+, monsters try to predict the party's position when aiming spells
  and missiles, based on your momentary speed.  On Hard, party hitbox for the
  purpose of determining projectile hits is also doubled in every direction.
* EI shop teaches Dagger instead of Staff; characters may start with knives.
* Fixed multiple game-breaking issues with the newly added dungeon.
* MMExtension v2.2 no longer breaks transport and Town portal destinations.
* Turn speed is fixed on smooth, ignoring possible incorrect registry values.
* v3.0 fix: dual-wielding Spectral/etc. weapons again splits damage properly.

-------------------------------------------------------------------------------

== Elemental Mod ver. 4.0 ==

This an open beta kind of release which I present mostly because I promised
myself and others to have something by New Year; some of the new features
that really ought to be here will be added in 4.1 or later.

I have touched on hirelings, optional difficulty features, and money-related
stuff.  There's also a brand new dungeon and a handful of added quests.


=== Service changes ===

In an effort to make SP restoration less trivial, temples no longer replenish
it.  Instead, it's a magic guild service that's only available to characters
with the guild's spell school learned.  Since some regions have only Elemental
or only Self guilds, and most guilds are closed at night, the player will
sometimes have to mind SP expenditure.  Furthermore, after refilling SP at a
guild the character gets a debuff that will drain that exact SP amount if a
Lloyd's Beacon is recalled within the next two hours, which dissuades the usual
exploitative use of the spell to teleport to a town and refill spend magic.

Magic guilds also sell spell scrolls, with the same spells they stock the books
of (and also Telepathy and Fate at the respective Self guilds, since these are
now scroll-only).  As such, it pays to join a guild even if (perhaps especially
if) the party has no one to learn that magic school.  The scroll mastery rank
(and power, to an extent) follows the guild rank (more on scroll power below).

Instead of being exchanged for semi-random items, ore lumps can now be used to
craft specific equipment items at appropriate shops.  This typically requires
several lumps of ore, a sum of gold, and some other consumable (such as potion
or scroll) thematically corresponding to the prospective item's enchantment.
All weapon, armor, and magic shops (except those on EI) accept orders of any
treasure level, but low-level shops will take a very long time to create an
expensive item.  While fancier shops are much faster, but also more expensive.

The regular items on sale in many shops have also been tweaked: except for
magic shops, most of them now sell better stuff, and some stores' repertoire is
changed as well -- notably, all armor stores now sell boots and cloaks.

By popular request, empty bottles in alchemy shops now restock on each visit.
Other items can be made to restock faster by buying them, which decreases the
shop's restock timer to a minimum of 1 day (naturally, the bottles are exempt).

One new unique store is added: the black market, which deals with stolen items,
unlike other shops.  It's also the place to go if you lost an important quest
item, since the Judge no longer returns them.  Items stolen by thief monsters
can also end up here.  The black market is in Erathian sewers, next to Lasker's
room, and the party will get a discount (as well as some other benefits) by
getting there without killing the thieves (which was unimplemented in vanilla).

Bank will now only grant interest to the money that spent one full week on the
account (Monday to Sunday), to prevent an obvious exploit of putting all your
gold there on Sunday evening and removing it the next day with interest.

Arena gold reward is slightly reduced, instead you will occasionally be
rewarded with magic hourglasses that can cause an area to refill on the next
visit (outdoor maps may need two uses).  Also, winning enough Lord battles
may grant a one-time special prize complete with a cosmetic title (award).

The hourglasses can probably be abused in a number of ways (such as getting
multiple copies of unique items).  I will try to fix this in future releases.

The vanilla box traders have been removed in favor of NPCs that buy certain
"special items" such as apples, horseshoes, ore, or the above hourglasses.
Unlike in MM6 and MM8, all of these items can also be used in some other way
besides just being sold, so it's an entirely optional feature.

Hirelings have been tweaked a lot.  Scholars no longer identify all items, but
instead only provide a bonus to ID Item skill (and experience gain).  Some
other skill-boosting hirelings were improved; item repairers now also either
grant a minor skill boost, or (in the case of alchemists) recharge wands daily.
Healers are cheaper.  And travel hirelings now also boost walking speed on
their respective terrain, including indoors, and hint which maps were refilled.

There are also several new professions.  First, Self magic boosters were split
into Sun clerics which also boost Light, and Moon clerics who boost Dark (and
reduce reputation).  This is to make them competitive with the Elemental magic
hirelings.  There are also ninjas who cast Invisibility daily, beacon masters
who cast Lloyd's Beacon, and bards which improve your reputation over time.

The identities of street NPCs no longer reset on each reload, but are now
re-randomized only once per two weeks (pretty much like in Merge).

Finally, some hirelings now reside in houses, like in MM6!  There's exactly one
of each profession scattered around the world, except on EI which has doubles.
Take note of the Evenmorn beacon master which are otherwise late-game-only.


=== Difficulty tweaks ===

People were complaining that the Hard difficulty is not hard enough, so I took
some more steps in that direction.  I didn't manage to implement all my ideas
before the release, so there'll be more hardiness later, until it's enough.

First, only some skills now get penalty at high difficulty, these are: ID Item,
Merchant, Repair, Perception, Disarm Traps, Dodging, Unarmed, ID Monster,
Armsmaster, Thievery, and Alchemy.  Mostly these are "misc" utility skills,
since I figured that combat is penalized enough already by monsters being
stronger.  Knight and Monk's signature skills are the exception, since they're
so strong (and since Thief's signature skill is still penalized, despite it now
having combat use).  As some magic is also utility, (all) spells instead get a
25%/50% increased cost -- this will also make SP run out faster as HP does now.

Chest traps are more nasty.  Triggering a trap on Medium or Hard will break
some of the items inside the chest, and inflict a further effect dependent on
the trap type: chance of poison, paralysis, or destruction of some carried
consumable items.  Naturally, on Hard all these effects are stronger.

To discourage savescumming, monsters now have semi-fixed item loot, except on
Easy (to make it optional).  Namely, for a given monster there's about a dozen
possible items it can drop (less on Hard, determined on map refill), so looting
and reloading will only grant one of these items (or none at all, if item drop
chance is low enough).  So it's likely that a dragon will have something good,
if you reload 4-5 times, but don't expect an artifact from each one you slay.

Invisibility got nerfed.  On Medium, monsters that are immune to magic can see
through it (this notably includes the blaster guys).  On Hard, ALL monsters see
you, but those not immune will miss you very often, and won't cast Dispel.  The
last one is just to keep Walls of Mist feasible, and may change upon feedback.

Immutability is also nerfed: on Medium/Hard, there's 25%/50% chance it fails to
protect you from a given bad condition (this does not weaken the spell).  This
will hopefully make the added death resistance of Preservation, as well as the
various condition immunity enchantments, less redundant even in the late game.

Finally, a lot of monsters got new or alternative spells that only "turn on" if
the difficulty is high enough (otherwise they keep their vanilla spellset).
Additionally, above Easy the buffs that are party-wide for the player will also
be applied to nearby allies of the monster that casts them, and a lot of new
spellsets make use of that.  Also, some new (to monsters) spells were added:
* Starburst, Deadly Swarm, Flying Fist and so on work as for the party;
* Sunray works as for the party, except at night it's replaced by Light Bolt;
* Inferno and Prismatic Light damage the entire party (and only it) at once;
* Regeneration is actually a caster-only one-time heal, not buff;
* Jump simply lets the monster quickly "sprint" towards the party;
* Telekinesis steals a PC's equipped weapon from range.
On that topic, most melee monsters have either Shield (cast on self only) or
Jump on Medium+, to keep with ranged PCs.  We'll see how it plays out.


=== Spells, potions and enchantments ===

There were some more spell tweaks since 3.0.  First, Ice Blast once again deals
1d6 damage per skill point, but there are no extra shards at GM, since they
made the spell too powerful.  Lloyd's Beacon duration is reduced to 2 days per
skill point, and it also interferes with SP restoration at guilds (see above).
Resurrection heals a bit more HP, and Incinerate has higher instadeath chance.
Also, Sunray has somewhat reduced recovery to make it more competitive.

Immutability now degrades faster when used to prevent more dangerous
conditions: at double speed against stoning and paralysis, and at triple speed
against death and eradication.  See also the high difficulty nerf above.

Turn Undead now deals minor damage to affected monsters, and if it's somehow
reduced to zero, the fear effect will not be applied either.

Psychic Shock is now an Expert-level spell with reduced cost and damage, as
Clerics had no midgame attack spell before.  Berserk takes its place at Master.

Armageddon again affects the entire map, and there's no unconditional
reputation loss, however the party takes full responsibility (in reputation and
fines) for killed innocents.  OTOH the XP for kills is not awarded anymore.
Additionally, to prevent multi-day Armageddon camping, all monsters on the map
are completely healed after approx. each full day the party spends there.

Fire Spike is more effective as an obstacle, as the spike will damage a monster
multiple time before disappearing, provided it's the monster stumbling into the
spike instead of the other way around.  In practice, this will significantly
delay non-fliers, since monsters abort walking whenever they take damage.
Also, spikes always deal d6 damage, and how much you can cast at once depends
on skill value, with rank instead determining each spike's durability.

Divine Intervention and Sacrifice no longer restore SP, so their cost matters.

Aura of Conflict can be dispelled with Ctrl-click on the spell icon.  And now
that it can't create problems, the buff's duration is massively increased.

Most spells can now be shot at an arbitrary point on screen with a Shift-click!
Meteor Shower and Starburst don't precisely follow the cursor when cast that
way, instead its vertical position determines distance from the party.
Accordingly, Rock Blast can now be aimed manually, either at monsters or walls.

Death Blossom can also be aimed, either at a monster (the game tries to predict
the required trajectory), or anywhere with a Shift-click (it will still fly at
an arc).  Also it has more shards on GM instead of the broken vanilla bonus.

Shield spell now works properly (it did nothing in vanilla!)  However, multiple
sources of half missile damage stack additively now, for 1/3 damage with two,
1/4 with three, 1/5 with 4 and so on.  (It was 1/4, 1/8, 1/16 etc. in vanilla.)

Temple blessings (cast on you for donations) now act as GM spells, except for
Wizard Eye.  In particular, it's now a reliable source of GM Immutability.

Scroll skill level is now variable, randomized based on item treasure level.
In particular, you can find scrolls cast at GM, such as in Paramount guilds.

There are two more weapon bonuses that add +5% and +10% to critical chance.
Additionally, these and other bonuses grant an increased effect (about +50%)
when applied to two-handed axes and swords (this also affects some artifacts).

Some enchantments are a bit stronger now, such as Doom or skill buffs.  Gods
is cheaper, and Carnage is nerfed: monsters are able to dodge the fireball.

X Slaying weapons no longer double weapon damage, but instead add +30% crit
chance (+20% for undead) against their targets, which scales into late-game
better.  Backstabbing weapons add +15% backstab chance in a similar vein.

Fixed bonuses are now somewhat more likely on armor, esp. from Enchant Item.

Divine Mastery potion now grants a proper buff that times out after a while.

Alchemy is now nerfed a bit: when distilling a reagent, skill value in excess
of reagent power is halved.  However, all grey reagents are now stronger.

There's one more black potion, Ultimate Cure, that fully heals a character (and
then some).  For full asymmetry, Divine Power is also a bit weaker now.

Finally, holy water now has lower duration when applied to coat weapons.


=== Other items and map objects ===

All monsters that leave corpses can now be looted for a chance of at least some
treasure.  For instance, sharks may drop randomly enchanted sharktooth daggers.

Fire elementals in particular may yield magic embers.  These are also
occasionally found in campfires and basically act like a GM Fire Aura scroll.

Other new consumable items include drinkable wines (one just makes you drunk,
another raises stats) and rare golden apples which grant some single-PC buffs.
Both kind of apple also cure weakness now, besides increasing party food.

Genie lamps were reworked again, and now grant a random blessing or a curse
that basically depends on the current day and the previously used lamps in a
complicated way that varies between playthroughs.  One possible blessing allows
you to "wish" for an enchanted item, much like a shop order (but for free).

Ore veins now grant a variable amount of ore, depending on Perception skill.

There are two new types of cauldrons, raising Mind and Magic resistance.

All HP/SP recovering wells have a per-day limit now.  OTOH, stat-boosting wells
are not once-per-day anymore, but once-per-rest, so they cannot be used twice.

The temple in a bottle is once again in Shoals instead of randomly dropped.

Many item caches that either contained fixed good items, or disappointing bad
loot, now have random high-level items (the vanilla engine could not place
random items with high treasure level to low-level areas; this is fixed now).

All of unique items have their own graphics now, of varying quality.

Weapon damage has been tweaked heavily, so that some items have higher damage
and some, better accuracy.  I also replaced two-handed double damage with just
higher attack/damage bonuses (and also stronger enchantments, see above.)

Finally, rings and amulets cannot have most AC-affecting enchantments anymore.


=== Other changes ===

The mod now has a complete new dungeon!  Kaltenberg modeled it, and it's likely
to be present in his mod, too, but I got to release first, at least.  The map
features several interactive puzzles and it can be found in eastern Bracada.

Snipers now have a unique promotion quest, tied to the above dungeon, with a
new Bow-related unique item as the reward.  The Perfect Bow remains for Master
Archers, and it's a much better weapon now (competitive even with artifacts).

Another new quest allows Monks to advance some of their skills to GM before
completing the second promotion.  This is an attempt to balance the extreme
"late bloomer" flavor of this class, although since the quest is initiated in
Evenmorn and then requires traveling to Nighon, it's not much of a shortcut.

There's also an "introductory" quest for the black market in Tatalia, that just
requires buying a "lost" quest item there.  Another quest is found in Avlee,
and it rewards the player with a third hireling (choice of three professions).

Choosing the new judge now provides an actual reward (XP and reputation).

Tatalian pirate ship now sails to Evenmorn even without completing the Priest
quest, but you'll need Bill Lasker to vouch for you, and it's not cheap either.

Perception GM teacher now requires finding only 10 obelisks instead of all 14.

Shield Master perk has changed: with it, the game treats your equipped shield
as two identical items, doubling all affected bonuses that can be stacked.

ID Monster shows a bit more info, and unlocking it just requires higher skill
value instead of advancing in rank (instead the rank acts as a multiplier).

Axe Expert recovery bonus is decreased from double skill to 1.5 times skill.

Merchant bonus from hirelings etc. is now affected by the rank multiplier.

Skill ranks available to some classes were changed again.  In particular,
Sorcerers can no longer advance Earth magic to GM (Rangers can, though).

Item repair now takes a turn, and cannot be performed by inactive characters.
Smith-type hirelings can still repair their item types instantly, though.

Some new hotkeys can be set in the Controls menu.  These include some MM7Patch
keys, a hotkey for repairing carrying items (mass repair is restricted near
enemies!), a hotkey for drinking a healing potion (on self only, for now), and
four new quick spell hotkeys (7890 by default, spells set in the spellbook).
Beware that hotkeys are system-wide, and if you, say, set the journal key to
F8, it will break once you run vanilla MM7, as only my mod allows F-keys there.

Accuracy stat was renamed to Agility, and it now affects AC instead of Speed.

Starting skills now all also add varied items to the starting PC inventory.

Shooting at monsters standing in unlit areas now imposes an accuracy penalty.

Manticores are properly introduced into the game, specifically under Eeofol.
Also, Tularean Forest has wild dragonflies now instead of just angry trees.

Monsters that drain SP do so on every hit, but the SP lost is much less now.

Chest traps have only a 50% chance to be disarmed if the skill is exactly equal
to trap difficulty (which is always even), making odd skill values more useful.


=== Bug fixes ===

Naturally, there are some more since the last time.

Fix: Efreet now attack with fire, and Genies with air.
Fix: Monk and Initiate hirelings shared string resources with the class.
Fix: Merchant hireling shared the string resource with the skill.
Fix: Fallen Wizard's buff duration increased from 5 to 6 hours.
Fix: some spells did not decrease recovery with rank despite the description.
v3.0 fix: Aura of Conflict had Telepathy recovery values.
Fix: preventing Stoned did not weaken Immutability.
Fix: Elfbane did not do any extra damage to elves.
Fix: GM Death Blossom wasn't actually improved besides recovery.
Fix: Fire Spike max allowed count was off-by-one.
Fix: the Shield spell actually works now.
Fix: some map objects were buggy (e.g. duplicate ore veins).
v2.0 fix: Sacrifice did not cure Eradicated characters.
v3.0 fix: some spells were cast with the wrong mastery.
Fix: Hero's Belt had Lady's Escort resistance bonus.
v3.0 fix: Incinerate can now instakill in monster-on-monster combat.
Fix: monster-on-monster spells had an attack roll.
Fix: blaster AC penetration did not use Squire etc. skill bonuses.
Fix: recovery penalty for running also applied while standing still.
Fix: cold chest traps exploded in a fireball.
Fix: one Walls of Mist area had random items lying on the ground.
Fix: monster Meteor Shower used MM6 projectile numbers.
Fix: armor shops were treated as empty with the two last items still unsold.
Fix: sailing to Tatalia and Avlee rotated the party the wrong way.
Fix: indoor map refill counter wasn't incremented properly.
Fix: lady Carmine only appears when the quest to kill her is active.
v3.1 fix: music is no longer disabled after starting a new game repeatedly.
Also there are multiple minor text typo etc. fixes.

-------------------------------------------------------------------------------

== Elemental Mod ver. 3.1.2 ==

Another tiny release with some bugfixes accumulated while writing 4.0.

* Lloyd's Beacon recall counter is now incremented after the autosave.
* Elixir of Life scrolls and spellbooks are now named as such.
* Fix AC bonuses from skills broken by some 3.1 code.
* Vanilla fix: now more than 9 sprites per map can emit sounds.
* Also the distance at which these sounds play is now decreased a bit.
* Fix the 3.0 bug that caused some chest items to be pre-identified.
* A bunch of text typo fixes, including incorrect Ethric's Staff description.

-------------------------------------------------------------------------------

== Elemental Mod ver. 3.1.1 ==

A really tiny release that fixes a handful of bugs before I start on 4.0.

* Elixir of Life no longer resets PC faces to the default party.
* Killing monsters with Ethric's Staff shouldn't cause crashes now.
* Fixed some typos in Russian documentation.

-------------------------------------------------------------------------------

== Elemental Mod ver. 3.1 ==

This is mostly bugfix and balance tweak release, although I did add some
features I skipped for 3.0.  Nothing major, though, that'll wait for 4.0.


=== Skill and spell changes ===

GM Thievery (exclusive to the Thief class) now allows backstabbing from any
angle and reselling items stolen from shops, instead of the old x5 bonus.

Learning now affects XP gained from quests and other scripted events.

Cure Disease is renamed to Elixir of Life, it now also cures Drunk
and Zombie and, more importantly, heals 12 HP per point of skill.

Armageddon now again has a 20 reputation penalty, but only once per map.

Hammerhands now grants (skill * 2) bonus magic damage to unarmed attacks and
(skill / 2) bonus magic damage to all other melee attacks.

Shield AC bonus now adds to the % chance to cover an ally (Master skill perk).

Archers can now learn ID Item, and Snipers can advance it to Expert.
Master Archers can instead advance Repair to Master.  Both can get GM Spear.

Sword and Spear GM perks are now changed to grant a % chance to parry melee
attacks.  This should be more effective than the old AC bonus.

Halved armor (from GM Axe ability) now also halves physical resistance.


=== Other new features ===

New item enchantments: Masterful weapons that add +5 to the weapon's skill,
boots of Kicking that add +5 to melee damage, and robes of Absorption that
grant a 10% chance to nullify spells, just like the Master Leather ability.

Flattener on-hit effect chance is doubled.

Lady's Escort now halves missile damage.

Titan's Belt now penalizes recovery less.

Gardener's Gloves no longer work in proving grounds.

Taking the trumpet from the chest in Tularean now turns nearby armies hostile.

Double-crossed human and elven royalty now still pay you money.

Markham's vase trap can now be disarmed.

Banks now have a "safe deposit box" that shares its contents across all towns.

There's now some fae dust in the Hall under the Hill.

Gogs now have a chance to carry some sulfur.


=== Interface and cosmetic changes ===

Immutability now shows the number of remaining uses along with duration.

Sword of Light now uses the lit sprite in the RMB description.

Hirelings now only complain about being fired after actually pressing the
relevant dialog option (press twice to actually fire them).

When looting a chest, the '5' key now places the held item into the chest.

It's no longer possible for recovering PCs to use potions.

The mod is now tentatively compatible with upcoming MMExtension v2.3.

Loading a 3.0 save will (mostly) upgrade it to the current mod version.

Ctrl-clicking on the Lightning Bolt spell icon allows casting it normally
(costing SP and using Air skill) even with a certain artifact equipped.

The ambient music no longer restarts on reloads.  Infinite looping option is
recommended, otherwise you can restart the music by exiting to the main menu.

Reloading now preserves the currently selected PC.

Harmondale signal fires now stay lit after the goblins spawn.

PCs now smile when winning a stat challenge.


=== Bug fixes ===

v3.0 fix: HP and SP regeneration did not work on robes.
Fix: Stealing from shops and people ignored item bonuses to the skill.
v3.0 fix: backstabbing success roll was inverted.
Fix: lichdom now grants immunity to zombification in all circumstances.
v3.0 fix: zombification now preserves race.
v3.0 fix: temple in a bottle area now no longer respawns.
v3.0 fix: Antique items were too difficult to ID and repair.
v3.0 fix: Russian Flattener name was too long, causing glithes in shops.
Fix: zombie faces no longer become stuck on total party kill.
Fix: too much Armageddon could displace flying monsters beyond party reach.
v3.0 fix: sometimes monsters were turning around even when not afraid.
Fix: teacher-type NPCs granted extra 9% to XP for PCs without Learning.
Fix: specitems no longer have zero repair difficulty.
Fix: aiming a spell in realtime mode increased its recovery to 140.
v3.0 fix: realtime combat at harder difficulties should no longer slow down
          monster attacks.  This fix may cause minor visual glitches, though.
v3.0 fix: maximum SP half-points were sometimes rounded the wrong way.

-------------------------------------------------------------------------------

== Elemental Mod ver. 3.0 ==

This release chiefly concerns party composition.  Characters are now defined by
more than just class, with race and light/dark path choice being more
significant, skill advancement is (mostly) more lenient, skill effects are
rebalanced, and hybrid classes are hopefully more viable now.  Also, I added a
bunch of new artifacts and some other items, tweaked spells some more, made a
number of other changes to game mechanics, and fixed some more bugs.


=== Race and class changes ===

This is the first core part of the release.  While before you could have nine
different kinds of characters, as only the class mattered, now each of four
races brings significant changes, and a choice of light or dark promotion also
impacts the PC's abilities, for a total of 72 possible combinations.

First off, race now has a more lasting impact on primary stats: instead of
doubling or halving them at the start only, they're now increased by 40% or
decreased by 30% respectively throughout the game, like a status condition.
To make humans less dull, they now have a similar 20% bonus to Luck.

Race now also affects HP and SP, like in earlier MM games: dwarves get +1 HP
per level, goblins get +1 HP/level but -1 SP per two levels, elves get -1 HP
but +1 SP per level, and humans instead get 12.5% more skill points per level.

Next, each race gets a boost to a single skill, generally being able to
advance it one rank higher than usual.  This works even if the base class
cannot learn the skill at all.  Goblins have Sword, dwarves have Axe, elves
have Bow, and humans get Learning.  For the first three, the boosted skill
usually replaces the weapon skill a class starts with; humans instead get
their Learning as a fifth bonus starting skill, which fits the scholar theme.

Finally, the racial bonus to resistances now increases with character level.
Humans are again special, as they now get a bonus to Holy resistance in
addition to Magic, although it's only relevant to liches and zombies.

Classes are now more varied, too.  Basically, I tried to make skill ranks more
permissive, especially magic grandmasteries -- hopefully clerics and sorcerers
are less indispensable now.  Hybrid classes like thieves, rangers and monks
should be more useful now, too.  Some classes even got special abilities.
A comprehensive party creation spoiler is included in the release: see
party.elemental.txt in the game folder (read it with a fixed-with font!)

Importantly, all classes have skills that can be advanced upon a light or dark
promotion only.  What really makes this flexible is the fact that you can now
mix light and dark promotions within the same party!  Basically, if you
complete all elf/human war quests on time, you'll get a short window of
opportunity where you can initiate both light and dark promotion quests at
your discretion.  That said, you'll now have to earn the ability to get a
promotion quest by completing other quests; before having to choose a side
formally, you can complete a total of two light and two dark quests, and
afterwards you're limited to the path you've chosen only.  Nevertheless, this
is enough to have any combination of promotions in your party, which allows to
"plug holes" WRT skill ranks -- e.g. only light path Archers can GM Water, and
only dark path Thieves can GM Alchemy.  It's better to plan this in advance.


=== Skill tweaks ===

As part of the class rebalance, some skill effects were changed, either to
make skills more useful, or to make a class more unique.  Here's a list:

Bodybuilding and Meditation are now more relevant on higher levels, as their
effect grows by 5% for each level after 20.  This means that each point of the
skill (multiplied by rank) adds 5% to base level-dependent HP or SP (past
level 20, that is).  Also, the effect of Endurance, Intellect and Personality
now works the same way.  To counterbalance it a bit, GM at the both skills no
longer increases their effect to 5x; instead, it adds HP or SP regeneration,
at one point per 5 minutes per 2 or 5 points of skill, respectively.

Perception is now more useful, as it increases loot from monsters: both the
amount of gold and the chance of an item are increased by 2% per point of
skill (multiplied by rank).  Note that only the active character's skill is
checked.  To keep it interesting, dragons and other monsters with formerly a
100% chance of an item are now capped at 80%, so the skill is still useful.
Also, GM now grants a 5x skill effect, as a "100% chance" wouldn't make sense
with this new loot increase.  Finally, bonuses to Perception from hired NPCs
are now properly multiplied by rank, like with most other skills.

Stealing is renamed to Thievery, and it now also allows performing backstabs.
It works similar to Backstabbing weapons from 2.0: only in melee and only when
the monster is turned away from party.  But unlike the weapon bonus, a
successful skill-based backstab doubles the entire damage of the attack,
including skill, spell, and stat bonuses (but not the elemental damage).  The
chance to backstab is 1% per skill, multiplied by rank.

Alchemy is now a bit more lenient, in that it's technically possible to brew
any potion at any skill level (or even without the skill).  However, there's a
chance of an explosion (based on the potion tier), and even if it succeeds,
the potion is marked as "botched", which decreases its power by 25% and makes
catalysts mixed with it 25% less effective.  So, the skill is still helpful.

Blaster skill is now limited by class.  But those classes who can achieve GM
can enjoy a new perk: a small chance to eradicate the target on hit.
Eradicated monsters disappear without leaving a corpse, though, and it doesn't
happen often: the chance is 0.5% per skill and monsters can resist vs. Magic.

ID Item and Repair are now more useful, as I've raised the ID/repair
difficulty of many items, and item enchantments further increase it now.  So,
raising them to GM is actually beneficial now.  Also, unidentified items are
considered unenchanted when determining the selling price to shops, and it's
no longer possible to read unknown scrolls and spellbooks -- as such, ID Item
now brings an actual in-game (rather than meta-game) benefit.  And to make
Repair more relevant, items are now rarely generated broken (except in shops).

I also tweaked some armor skills.  Master Shield now grants a skill-based
chance to cover an ally in combat instead of a modest AC bonus.  What this
means: if any PC is attacked, with a (skill * 1%) chance the AC of the
shield-wearer is used instead of the hit PC's AC (unless it's lower).  If the
AC roll then fails, the original PC is hit as normal.

GM Shield now lowers all physical damage by 25% instead of the old half
missile damage bonus.  The old bonus wasn't actually all that bad, as unlike
the common opinion, it did stack with the Shield spell, and also affected the
elemental projectiles, but it was still inferior to an off-hand sword.  The
new bonus can stack with Master Plate for a total of 75% reduction, making a
Knight or a Paladin a very good tank (see notes on the aggro system below).

Master Leather is now limited to magical classes, as its new ability is
hostile spell absorption: any time the wearer is hit by a spell (including
friendly fire), there's a (skill * 1%) chance of negating its effects (on this
PC) and adding its cost to the PC's SP pool instead.  Importantly, it will
fail if there's not enough "empty space" for the absorbed SP, which is why
Knights can no longer learn this.  Light Bolt is the only spell that cannot be
absorbed, and magical projectiles that aren't spells also don't count.

I've also shuffled the GM effects of a few skills: the GM effect of Leather is
replaced by the GM effect of Dodging (dodging in leather armor), the GM effect
of Dodging is replaced by the Unarmed effect (the ability to dodge any hit) --
and by the way, I've fixed it so that ANY hit can be dodged, melee or ranged,
not just arrows (which might've been a vanilla bug); spells can't be dodged,
though, -- and the new GM effect of Unarmed is "death touch": 0.5% * skill
chance to instakill a monster on hit.  Monsters can avoid this effect through
Physical resistance; undead, golems and other non-living monsters are immune.

Next, ID Monster is improved.  One, the game now remembers whether a monster
was identified (and at which rank), like with items, and subsequently shows
its stats to any PC.  Two, identifying a monster also works like a minor
debuff: at Normal, party has +5 to armor penetration against the monster.  At
Expert, the monster also gets negative 5 armor penetration vs. the party.  At
Master, the monster also deals 10% less damage to the party (except with
Energy attacks).  And at GM, party also gets +5 resistance penetration vs. it.

Magic skills are not changed in behavior, but you now need skill level 8 to
train to Master and 12, to GM, unlike 7 and 10 resp. for all other skills.

I've also buffed Axes a bit by doubling the skill's Expert recovery bonus.

Master Dagger bonus is changed, it now adds skill to critical hit chance
(normally equal to Luck bonus, see below).  Essentially it's a damage
multiplier, so wielding a good weapon together with an offhand dagger is a bit
more advantageous if you have Master.  Archers in particular can do it now.
Wielding two daggers doubles the bonus, and throwing knives are also affected.

Finally, the AC bonuses of Staff, Sword, and Spear skill are boosted a little
by adding the weapon's quality (i.e. its to-hit, usually) to the skill.


=== Artifacts and other items ===

Another large part of the release is artifact-related.  I've added 15 brand
new artifacts and relics, 16 if you include a former specitem that basically
only retained its appearance.  The total number of obtainable artifacts have
also been increased to 20, but I've removed the ability to get an artifact
beyond this limit from some chests (Clanker's, Zod, and there's a couple of
new ones); rather, all such artifacts count towards the limit, and you cannot
get a second one after respawn.  I don't want to describe the artifacts here,
as it would spoil the fun, but if you're curious about what I've added, visit
https://github.com/Tomsod/elemental/blob/v3.0/artifacts.eng.txt

Some vanilla artifacts have also been tweaked: Titan's Belt now directly
increases melee damage and worsens recovery instead of the stat bonuses that
often amounted to little.  Ethric's Staff is now Soul Stealing, and it also
reanimates monsters slain in melee as loyal zombies.  But, it drains HP at a
fivefold rate.  The drain turns off when you're resting, though.

Clanker's Amulet now only gives +10 to Alchemy, but this bonus stacks with
another Alchemy item.  It also empowers Enchant Item, same (and non-stackable
with) as casting at noon.  Finally, Shadow's Mask skill bonus also stacks.

The relics that are Good or Evil only can be used by Light- and Dark-promoted
PCs respectively, even if the rest of the party has chosen the other path.

I've also added unique sprites from MM6 and MM8 to many specitems.

Next, I added some new regular items.  The graphics for these (as well as for
some new artifacts) were drawn by Arakazam, who's pretty cool.

The first new item class is robes.  These are equipped in the body armor slot,
but provide minimal protection.  However, they allow using the Dodging skill,
and can occasionally be enchanted with magic boosters and other nice bonuses.
They also don't impact recovery and don't require any skill to use.  There are
three regular kinds of robes, plus one artifact and one specitem.

The other item class is throwing knives.  They're a missile weapon that uses
the Dagger skill.  Early on they're inferior to bows, as they fly in an arc,
deal less damage and can run out of charges, but Sorcerers and Druids have
few other options as they can't use bows now (unless they're elves).
Later, knives can shine as they get bonus damage and range from Might, and
their recovery is very low compared to bows.  Also, the top-tier knives have
unlimited charges.  There are three kinds of ordinary knives and one specitem.

There are some changes to vanilla items, too.  Notably, crowns and staves now
have separate enchantment pools, and can be generated with the magic boosting
bonuses.  Also, these two plus robes have a lower chance to start unenchanted.

Next, to make the above items relevant in the early-midgame, I've added lesser
magic-school-improving bonuses, that only give +2 to a single school (plus a
resistance bonus), but can appear much earlier.  Naturally, they don't stack
with the better "of X magic" ones nor with each other.

Other enchantments I've added: "Elemental Slaying" weapons, like in MM8.
"Blessed" weapons, which have +10 to-hit and protect against curses.
"Terrifying" helmets, which cause fear on a melee attack.  Armor "of
Taunting", which increases aggro (aggro will be explained later).  And weapons
"of the Jester", which also increase aggro and deal some extra Mind damage.

The "Sturdy" enchantment is removed due to its overall uselessness.

Mekorig's Hammer is now Elemental Slaying.  The Perfect Bow is either Blessed
or Cursed, depending on the path.  And Amuck is Terrifying.

Blasters can now be sold, and no NPC besides the Celeste and Pit weaponsmiths
can ID or repair it (including hirelings).  PCs also need high skill to do it.

It's no longer possible to repair items lying on the ground.

Different items that regenerate HP (but not SP!) now stack with each other.

And another change: items that increase HP, SP, Thievery and Disarm skills are
now halved in effect, like the vanilla Armsmaster etc. bonuses.  However, at
least the Disarm bonus is now multiplied by rank, which compensates for it.


=== More spell changes ===

This release also includes a number of spell tweaks that didn't fit into 2.0.

Charm and Enslave now "formally" make the affected monster peaceful, i.e. it
shows green on the minimap, you can rest next to it, and if it's a peasant,
you can talk to and hire it.  Vanilla explicitly disabled that, not sure why.

Reanimation now makes the resulting zombies enslaved, so they don't turn
hostile when damaged and remain peaceful as above.  But, their max HP is
lowered to the HP you reanimate them with, so they cannot be healed later.
Also, killing zombies no longer gives XP, but you do get the loot, expect for
a possible extra reagent (like troll blood), which never appears now.

Recharge Item (and wand recharging in general) now only affects the portion of
the wand's charge that was already spent, i.e. if you have a 50% spent wand
and you recharge it to 50% charges, it will only lose 25% of its max charges.

I've also added another new spell: Aura of Conflict, which replaced Telepathy.
It compels monsters to attack the enchanted PC in preference to the rest of
the party, so it's good for tanks, who can actually make use of high AC, HP,
and armor skill perks now.  In more technical terms, this spell adds +1-4 to
the PC's aggro counter, which is normally 1, but can be higher if the monster
prefers the PC's class, race, or gender.  Some items (enchanted with "of the
Jester", "of Taunting", and Gibbet) also add +1 each.  And when the monster
attacks, the odds of attacking a specific PC are proportional to her aggro.
Also, Shadow's Mask removes these race-class-gender aggro bonuses when worn.

The old Telepathy spell is still available on scrolls, like Fate.  And by the
way, the latter turned out to be non-functional when cast on a PC, so it's now
only castable on monsters (which freed the space for the above Aura buff).

Enchant Item is buffed again, as it never fails now, and higher skill value
lowers the minimum enchantable item price slightly.

GM Fire Aura is nerfed: the resulting permanent enchantment no longer adds
2000 gold to the weapon's price; instead, it merely doubles.

Inferno and Prismatic Light are boosted a little (resp. to d2 and d3).  While
even in vanilla they could be cost-effective, it just wasn't often enough.

Immolation now lasts slightly longer (5 and 15 min/skill on Master and GM).

Invisibility now lasts shorter (same values as above), and opening a chest
immediately dispels it.  You can still pickup items from the floor.

Sparks and Poison Spray are now a bit more expensive on higher ranks, and no
longer have lowered recovery.  I only haven't nerfed them more because unlike
most other spells, they compete with melee weapons instead of bows, but even
with that, they were way, way too cheap for their late-game effectiveness.

Ice Blast is nerfed again (to d4), as it turned out to be too strong at GM.

Souldrinker now restores HP equal to the amount actually drained, instead of a
fixed per-monster value (which didn't even check immunities).

Paralyze effect is nerfed, as it now has a 20% chance to wear off each time
the affected monster is damaged.  Thus, it's not an instakill spell now.

Hammerhands spell now works together with GM Staff.

Town Portal is severely nerfed, as it now only teleports to the last visited
town on Master, and only at GM you can choose.  Also, the success chance is
lowered to 5% * skill both at M and GM, but with no monsters nearby it's 100%.

Lloyd Beacon is also nerfed, as a character can only recall one beacon per day
per 3 points of skill.  Setting new beacons is not restricted, though.

GM Water Walk now allows safely walking on lava (but it drains SP now).

Master Meteor Shower only summons 10 meteors now.

Stun is massively improved: in addition to fixing some related bugs, it now
inflicts quadruple knockback and quintuple recovery penalty (but, if the
monster already recovers, it's reduced to prevent stunlock).  Also, Earth rank
now decreases (the caster's) recovery from the spell.

Armageddon is nerfed again: it only deals full damage to the nearby monsters
("yellow gem" distance), and further away it's linearly reduced.  However, it
can now be cast more times per day, and the reputation penalty is lowered.

Incinerate (including when cast by monsters) now has a small instakill chance.

Flight is nerfed: it can no longer be initiated above the usual max altitude,
and in turn-based mode it's restricted much like in Merge.

Finally, I've added the ability to auto-cast some normally single-player buffs
like Regeneration and Fire Aura on all PCs at once by Ctrl-clicking the spell
icon.  It only works with no monsters nearby, and SP cost and recovery are
multiplied appropriately.  This doesn't work on every buff.  Weapon
enchantments are applied to every wielded melee weapon, or to every wielded
missile weapon if no melee weapons can be enchanted (or if all already are).
Also, Ctrl-clicking Immolation and GM Wizard Eye icons now turns them off.


=== Other gameplay changes ===

There's a bunch of other assorted mechanical changes and new features in 3.0.

First of all, I've added a difficulty level switch!  It's accessible through
the Controls menu and can be changed anytime except in combat.  You're advised
to play with the setting and find what you're most comfortable with, as the
vanilla game gets boring once you know how to play it well.  The default level
is "easy", and it has no special effects.  On the "medium" level:
* monsters have a 25% lower recovery (pause between actions);
* monsters receive 25% less damage from any source;
* monsters have a 25% chance to resist instant death effects;
* the party gets 25% MORE experience for defeating monsters;
* the party gets 25% less gold from almost any source (including sell prices);
* and most PC skills are reduced by 25% (rounded down) of their base value.
On the "hard" level, all those changes are increased to 50%.  Note that the
lowered recovery doesn't always work in real-time mode, as monsters still need
to complete their attack animation before they can attack again.

Next, I've slightly changed the main questline.  As noted above, it's now
possible to complete light and dark promotions in the same game (although you
can't get both for the same class).  It's also possible to join both light and
dark guilds.  Alternatively, you can refuse this opportunity and gain another
small bonus later.  Also, you no longer need to wait four months after the
castle repair for the judge to die: as long as you complete all the related
quests, you'll need to wait a few days at most.  But if you do procrastinate,
there will be the wait, and there won't be the light-dark thing as above.

And because you no longer need to kill time, level training now only takes 8
days no matter the number of levels, like in MM6.  Also, after getting each
10th level, the PC can visit the permanent "+2 to stat" wells once more, FWIW.

I've also gave all GM teachers varied demands besides just skill and gold.
Some even give you mini-quests before they can teach you!  A lot of teachers
just ask for practical experience, i.e. a specific number of successful uses
of the skill (killed monsters for weapons, dodged hits for armor, etc.)  Most
magic GMs now require enough resistance to a specific element.  For this, only
"permanent" bonuses count, such as from equipment, so you may want to stock up
on elemental resistance rings in advance if you want GM spellcasting early.

Some primary stats now have new effects.  Intellect increases wand damage,
and Personality improves trading prices; below 30 or so they will actually
penalize those two compared to vanilla.  And Luck now gives a chance to deal a
double-damage "critical hit" on a weapon attack.  This does not stack with a
backstab, and you still need to make a to-hit roll as normal.  Low Luck can
cause you to miss instead.  Also, its effect on resistances is now quadrupled.

You can check your critical hit (or miss) chance, and also average damage per
round (disregarding elemental damage and monster armor class and resistances),
by right-clicking on the PC's damage values at the stats screen.

To counterbalance increased stat and skill effects on HP and SP (which had
resulted in obscene numbers in the late game), the experience thresholds for
advancing a level now grow cubically after level 20.  I've taken care to
ensure the skill points to XP ratio remains roughly the same, though.

Adding to the above, training hall prices now grow as level squared past
level 20.  I've also made the high-end training halls more expensive, and
lowered the level limit in most halls so as to keep max XP roughly the same.

I've massively nerfed recovery bonuses: they're now multiplicative.  For
instance, at Expert 7 in Sword or Bow, the PC no longer gets -7 to recovery,
but instead -7%, i.e. it's multiplied by 0.93.  All skill, stat, and magic
bonuses are affected, but penalties (e.g. from armor) are still added to base
weapon recovery (before the multiplication).  This means most classes will
struggle to get more than 3 attack per round (except with blasters).  Knights,
with enough Armsmaster bonuses, are still able to reach the recovery limit,
which is now 10 attacks per round for all weapons.  This was mostly intended
to nerf melee, so I've also improved base bow recovery to 90 to counteract it.

Some hirelings have been redone.  Porters, quartermasters, and gypsies now
work as "portable chests", carrying some of your loot or other items.  Like
with most hirelings, two identical professions don't stack here.

Cooks and chefs now give you a moderate stat boost after resting in the field
(like in MMX!)  You can also get a similar boost by resing in a tavern.

There are two more black potions.  One, "Divine Mastery", increases the PC's
level by 0.2 per point of power until next rest.  This not only increases HP
and SP pools, but can also grant a small (percentile) bonus to skill values.
You can also get a similar effect from resting, as noted above.

The other black potion can raise dead (but not eradicated) PCs, and it
restores a little HP, too.  It actually replaces the Stone to Flesh potion,
which is now white, replacing Cure Paralysis, which is now an alternative
effect of Recharge potion.  I've pilfered the idea from BTB's mod, actually.

Also, I've swapped green and blue potions and reduced the 10 SP bonus to 5.

Next, spells cast from weapon hits (e.g. Cursed bonus or mace stun) now use
the weapon's skill to determine resistance penetration and other such effects.

Racial artifacts are no longer awarded for the Arcomage quest, but are instead
spread around as quest rewards, stealable treasure, or both.  Also, I've
reintroduced Elfbane, so there are now two goblin artifacts in the game.

Necromancers can now curse on hit, and Droids are vulnerable to lightning.

Medusae are now VERY resistant to Physical-elemental spells (not weapons).

Temple healing price is greatly increased for PCs past level 10.

Arena victories now reward five times as much money.

Castle Harmondale now has 10 more chests!  The new map was done by Eksekk, and
my contributions were minimal.  The new chests are spread around the castle.

You can now collect taxes at Harmondale town hall!  Their amount depends on
your fame gained since last visit, and also on Harmondale reputation.  If you
arrange Harmondale to become an independent kingdom, taxes will double.

A visual convenience feature: when a buff has less than 10 minutes left, the
buff icon will blink.  It doesn't work for buffs with huge icons like Water
Walk, and it's a bit glitchy in the widescreen mode, but it still works there.

Another interface thing: when browsing spellbooks in a guild, it's noted in
the upper left corner of spell description if the current PC can learn it.

In PC skill descriptions, available skill ranks use more descriptive colors:
white = can learn w/o further promotions, yellow = can learn after the first
promotion, green = after either second promotion, blue = light promotion only,
purple = dark promotion only, red = can never learn this rank.

Water Walk and Fly cast from scrolls no longer drain SP.

Vampiric weapons can no longer drain more HP than the late monster had left.

Berserked monsters (except peasants) no longer run away because of low HP.

I've added swords in stone (like in MM6) to a few outdoor locations.

Liches no longer suffer penalties from old age.

Finally, I've completely removed multiloot.  No more 10 relics from Wromthrax!


=== Bug fixes ===

As always, some vanilla bugs were discovered and fixed.  Here's the list:

Fix: the amethyst gem was misspelled as "amythest" in English.
Fix: all reagents were described as "herbs" in English.
v1.0 fix: Enchanter NPC description mentioned old elements.
v1.0 fix: English text for the Glory Shield had "Ego" instead of "Self".
Exploit fix: Divine Intervention book could be duplicated by Judge and sold.
Fix: can no longer buy several crates of goods at the same time.
Fix: peaceful monsters could cast Dispel Magic on party.
Fix: sometimes the "more information" hireling dialog has to be clicked twice.
Fix: effects of some potions weren't removed on rest.
Fix: HP/SP regeneration only triggered every 6 minutes while waiting with 'R'.
Fix: PC recovery could be set to garbage values on game reload.
Fix: evt.Sub("QBits") triggered a smile even if no visible changes occurred.
Fix: raised age was highlighted green instead of yellow/red.
Fix: a chest in Tularean had 0 power potion and 0-charge wand.
Fix: Harmondale town hall placed bounties on peasants instead of trolls.
Fix: Celeste town hall placed bounties on angels.
Fix: some areas had 0-charge wands lying on the ground.
Fix: restored rubies on Nighon volcano and prevented some from falling in.
Fix: Nighon HP and SP wells had wrong messages and autonotes.
Fix: repairing an item no longer IDs it.
Fix: Stun spell could miss, using the equipped bow's attack value.
Fix: weapon stun checked for Earth resistance.
Fix: monsters that attacked a specific class ignored its promotions.
Fix: monsters with a custom loyalty didn't attack their enemies sometimes.
v2.0 fix: Spectral weapons didn't account for monster Day of Protection.
v2.0 fix: shooting wands often made no sound.
Fix: Russian description of Hareck's Leather listed a boost to a wrong skill.
Fix: Hammerhands spell description was incorrect (and mentioned old elements).
Fix: some skill teacher dialogue had typos and wrong skill descriptions.
v2.0 fix: can mix new black potions with each other (with an explosion).
v2.1 fix: Backstabbing weapons were broken for a while.
Fix: Bodybuilding and Meditation had wrong example numbers.
Fix: unpromoted Rangers could learn Meditation despite having no magic.
Fix: RMB class descriptions were nonfunctional and often incorrect.
v2.0 fix: Hammerhands spell didn't work properly.
Fix: lichification reset the PC race to human.
Fix: ID Item and ID Monster appeared the same as chargen skill picks.
Fix: there was a floating bush in Tularean in summer.
Fix: gold piles on the ground could contain too much gold.
Fix: some Tatalian guard archers had peasant AI.
Fix: a male peasant in Celeste had female portrait and name.
Fix: shopkeepers used the discount dialog even if the discount was negative.
Fix: some reagents in Harmondale were unreachable except with Telekinesis.

-------------------------------------------------------------------------------

== Elemental Mod ver. 2.1 ==

This release was mostly prompted by my comissioning new graphics for
dragonscale items and the new spell.  While I waited on it, I also wrote
a few tweaks and bugfixes.  The full list of changes is below:

* The Morcarack's scales and the plate armor and shield made from them
  now have unique graphics.  The Spectral Weapon also gets a decent icon.
* Primary stat thresholds have been rebalanced.  Expect to have 4-6 extra
  stat rating points in the midgame.
* Undead Slaying has been nerfed, and now only increases damage by +50%.
* Elemental damage potions now grant better enchantments to weapons.
* Combined damage messages now work with Splitter: the damage from the hit
  and from the fireball is combined.  Halved armor message may still
  be suppressed, though.
* Primary stat hints now note if a corresponding pure black potion has been
  used.  Resistance hints now show base value and average damage reduction.
* The RDSM crafter now changes his greeting if you do business with him.
* Flying Fist has been changed to its MM8 version.
* Zero-power pure black potions now don't set the "potion was drunk" bit.
* v1.0 fix: Destroy Undead targeted some PC slots preferentially.
* v1.0 fix: new buff icons weren't displayed in the widescreen mode.
* v2.0 fix: couldn't autobrew gray potions.
* v1.0 fix: the new monsters spells could target the party through walls.
* Vanilla fix: "of David" didn't work on bows.
* v2.0 fix: expired temp enchants weren't removed before an attack.
* v2.0 fix: could not sell the new recipes.
* Vanilla fix: item-targetting spells rarely affected a wrong item.
* v2.0 fix: Day of Gods from pedestals wasn't nerfed.
* Vanilla fix: crappy items could be generated on high tlvls.
* Vanilla fix: altar of the Sun and Clanker's device resetted their visual
  appearance on map reload.
* Vanilla fix: could not swap equipped spear with some other items.
* v2.0 fix: Eofol well made money sounds even at 0 gold.  Also I tried
  to reduce visual glitches when using it.

-------------------------------------------------------------------------------

== Elemental Mod ver. 2.0 ==

While I originally intended to create a separate balance-concerned mod for
MM7, I ended up extending this mod with all of my ideas instead.  As such,
"Elemental Mod" is slowly becoming an artifact title.  Well, at least it's
catchy!  The final vision for this mod is to "polish" the game by improving
game mechanics, adding convenient new features, and hopefully improving, or at
least not breaking too much, balance.

This release mostly concerns itself with the magic system (broadly speaking).
There's also a bunch of rule changes and a surprising number of bug fixes.
Hopefully, the latter will be eventually assimilated by the MM7Patch.


=== Alchemy changes ===

The first main topic of change is potions.  In general, alchemy should be more
useful and versatile now, and having a Druid is rewarding.

Several new black potions have been added.  Six of them provide a temporary
immunity to one of six elements (fire, shock, cold, poison, mind, or magic).
Their duration is quite short, but complete elemental immunity is hard to
obtain otherwise, which gives an edge to Druids who alone can brew these
potions freely.  There's also a black potion that duplicates the Pain
Reflection spell.

Alchemy has been given an offensive option it lacked before by repurposing
weapon-enchancing elemental potions into short-range AOE thrown weapons.
(They still retain their old utility, as well.)  Thrown potions are affected
by gravity, so their range is limited, especially for characters with low
Might.  On impact, they explode, damaging monsters in a small radius.  Damage
is (power)d3 for Flaming and Freezing potions and (power)d2 for Shocking and
Noxious potions.

Another new quasi-potion is holy water.  It's outside the alchemy system, but
behaves like a potion otherwise.  Holy water can be bought at most temples and
acts similarly to the potions from the above paragraph, able to either
temporarily make one weapon Undead Slaying, or be thrown to damage a group of
undead monsters.  Unlike elemental potions, the thrown holy water is safe to
use at a point-blank range -- unless, of course, you have undead in the party.
Holy water is especially notable as one of the few ways to reliably damage
Ghosts and Wraiths, who are now immune to unenchanted weapons.

Swift Potions have also been given a new functionality: drinking them causes
the character to instantly recover (i.e. get an extra turn).  It's probably a
suboptimal use of a potion in most cases, but some spells (e.g. Resurrection)
have very long recovery which could make it worthwhile in a combat situation.

There's a number of tweaks as well.  Notably, black potions of Pure Attribute
(Might, Accuracy, etc.) now give a bonus equal to their power instead of a
fixed +50.  Since they're usually generated with 20-30 power, this adds a
strategic dilemma: do you drink one as soon as you find it, obtaining a
smaller bonus early, or wait until you find a Philosopher's Stone and an
Alchemy-boosting item, which together can improve the potion's power to 100+,
thus giving your character a bigger, but delayed, bonus?  You're still limited
to one of each potion per character, so you cannot choose both!

Potions of Bless, Heroism and Stoneskin have been made a lot less useless by
adding half of the potion's power to the resulting buff's power.  (Previously,
these potions always gave the minimal possible bonus of +5, which could be a
bug.)

Slaying Potions now have a permanent effect if posiible.  Honestly, I was
somewhat surprised to learn they didn't have it already.

Most potions (specifically, those for which power matters) now have variable
price dependent on power.  For typical randomly generated power values, the
resulting price should stay around the same.

The potion recipes sold at alchemy shops have been improved as well.
They now list the exact needed mixtures instead of cryptic guidelines, and
reading them automatically adds the recipe to your journal.  With the
proliferation of spoilers, trying to get the players to discover the recipes
for themselves is pointless anyway!

Last, but not least, I've added an ability to brew any potion in a single
click, provided you know the relevant recipes, have the reagents and enough
bottles, and posess the necessary Alchemy skill!  It's as simple as
Ctrl-clicking on an existing potion, or its recipe.  The game will then
attempt to brew another potion of the same type, first from other potions, or
otherwise from base reagents.  It works exactly like brewing it manually, and
you will be given a descriptive message if the process fails.  This
functionality is mostly intended to help streamline batch-brewing potions.
I'm quite proud of this one.


=== Item enchantments ===

The next major part of this release concerns item enchantments AKA bonuses,
such as "Vampiric" or "of the Gods".  Actually, I mostly concerned myself with
weapon bonuses specifically.  One of the mod's goals is to strengthen weapon
combat, as it's commonly considered inferior to magic, and improving weapon
enchantments helps towards that.

First off, I added a total of nine non-numeric enchantments.  In the below
list, "tlvl" stands for treasure level, which ranges from 1 to 6.

Spectral: any weapon, tlvl 3-5.  Improves the weapon's resistance penetration
by changing the element of the attack from physical to magical when it's
beneficial.  This allows damaging monsters that are immune to normal weapons,
such as Oozes; the mod also gives this immunity to Ghosts and Wraiths, and
this enchantment is one of the best ways to deal with them.  It's still
helpful against other monsters, as many enemies are vulnerable to Magic.
When fighting with two weapons, only one of which is Spectral, the enchantment
only affects 50% of the combined damage.

Cursed: any weapon, tlvl 4-5.  When hitting a monster with this weapon, it
will apply the Cursed debuff with a 20% chance.  Monsters that fail a Magic
resistance roll will, for the next 20 minutes, have halved chance to-hit, 50%
chance of a spell failure, and about 25% lowered elemental resistances.
This is mostly identical to MM6 Mass Curse spell (except for the last part),
but in this mod, weapons are the only source of the debuff.  Wielding two
Cursed weapons provides no additional benefit.

Of The Wraith: any weapon, tlvl 5-6, uncommon.  Combines effects of Spectral
and Cursed.

Soul Stealing: melee weapon, tlvl 5-6, rare.  A counterpart to Vampiric
weapons, it will restore some spell points when the character kills an enemy
in melee.  Wielding two such weapons doubles the effect.

Of Backstabbing: melee weapon, tlvl 3-5.  Another "double damage" enchantment,
this one works on any monster, but only if they're turned away from you.
Usually enemies will look at you in combat; reliable ways to get them to turn
around are Mass Fear (or Turn Undead), or Berserk to provoke infighting.

Lightweight: body armor and shields, tlvl 3-5.  Reduces the armor's recovery
penalty by 10, assuming it's not already nullified by skill.  This means that
Lightweight leather and shields never slow the character down at all, and
chain and plate with this enchantment will have a penalty of 0 and 5
respectively when combined with Expertise in relevant skill.

Of Leaping: boots, tlvl 3-4.  Each pair of boots of Leaping increases jump
power by 20%, and multiple pairs stack linearly.  They do not affect the Jump
spell.

Of Permanence: shields, helmets and jewelry, tlvl 4-5, uncommon.  Make the
wearer immune to the Dispel Magic monster spell.  This spell is nerfed in
several ways in this mod, and this is one of them.

Sturdy: anything but belts or jewelry, tlvl 3-4, rare.  The enchanted item can
never break.  Essentially duplicates the effect of Harden Item potion.

Next, I've completely rehauled the temporary enchantment system as provided by
Fire Aura and such.  Now pretty much any weapon can have a temporary
enchantment, including already enchanted weapons and artifacts.  This means
that a weapon can have two bonuses at the same time (permanent and temporary),
and it also means that Fire Aura no longer becomes useless when you outfit the
party with good enchanted weapons.  The only limitation is that the temporary
enchantment musn't be similar in nature to already present bonuses.  For
example, Ghoulsbane cannot be enchanted with Fire Aura or holy water, and
weapons of Darkness are unaffected by Vampiric Weapon spell and Swift Potions.
Also, due to their unique nature, bows of Carnage can only be made Swift.

Among other changes, Undead Slaying weapons now act similarly to the new
Spectral weapons, dealing Holy damage when attacking Undead.  As noted above,
this makes holy water very helpful against Ghosts and Wraiths in partucular.
Most Undead are very vulnerable to Holy, making this enchantment superior to
Spectral within its scope of effect, especially considering the double damage.

Also, Assassins' weapons now have backstab instead of the modest Disarm bonus.


=== Spell tweaks ===

Probably the core content of this release is the multitude of player spell
tweaks.  Some spells are improved, some are nerfed, and one spell is entirely
replaced.  One goal I strived towards was to make GM changes of spell effects
more significant, as many spells had underwhelming changes at grandmastery in
vanilla.  This was partly because the magic system was blindly copied from
MM6, where any spell could be cast at any level of mastery, and even high-cost
spells were substantially better at Master (which was harder to attain than
MM7 Master).  But in MM7 spell availability is limited by skill, and as the
result the weaker effects of higher-level spells were simply discarded, often
leaving them overpowered from the get-go, and with no room for improvement at
GM.  As such, many spells are now rebalanced by shifting them one level of
mastery upwards, with Expert having the effect of MM6 Normal skill, Master
casting as Expert, and GM working as the previous Master.  Some other spells
were instead just made stronger at GM.  I also improved most debuffs.

Condition cure spells are the prime example of the "shifting" approach, as the
vanilla GM bonus of unlimited delay was just too useless -- as rightly noted,
at Master the allowed delay is already 7 days, and who would wait over a week
before casting a cure?  So, all Expert- and Master-level cure spells are now
shifted to 3 min/level at E, 1 hour/level at M, and 1 day/level at GM.  Cure
Weakness and Remove Fear are improved instead, acting on the entire party on
GM.  Awaken already had, so I just removed the unlimited delay to keep it
uniform, but left the shortened recovery in place.

Resurrection merits special mention, as I felt having a slightly improved
Raise Dead as Spirit's ultimate spell was a bit underwhelming.  Now it's a
"combat revival" sort of spell, as not only it resurrects, it also doesn't
inflict weakness and restores some HP, leaving the character ready for combat.
It can still cure eradication like in vanilla, and it remains the only cure
spell without a time limit.  The only practical downside is the 10-minute
recovery this spell imposes; I haven't changed that.  (The vanilla description
claims that higher skill lowers recovery, but this was never actually
implemented, and I removed that note.)

As mentioned above, I reworked the debuff spells.  While generally magic is
overpowered, this is not the case for debuffs, which are frustratingly
unreliable, especially in the late game.  Thus, I made spell skill improve
their success chance.  The improvement isn't dramatic -- with high skill
you'll get maybe 150% of the base chance against tougher targets -- but it's
still noticeable.  A price to pay for this is that the debuff duration is now
mostly fixed -- it increases with mastery, but the numeric skill value doesn't
affect it anymore.  Generally it's still enough to last through the combat,
though.  Turn Undead was also affected by the latter change for uniformity,
but since it cannot be resisted at all, higher skill reduces recovery instead.

I also added one completely new spell: Spectral Weapon.  It replaces Fate,
and, true to its name, can enchant one weapon to become Spectral.  It's a Self
counterpart to Fire Aura and Vampiric Weapon, and works much the same.  The
spell can be useful both in early game, when you need to fight Ghosts and
Oozes, and later, when a lot of monsters are less resistant to Magic than to
physical attacks.  Fate still can be found on scrolls, but you cannot learn it.
The icon for the new spell may be replaced with a better one in the future.

Next, I backported some spell changes from MM8.  Ice Blast now deals 12 +
(level)d6 damage (up from d3), Spirit Lash now damages all nearby monsters,
and Regeneration is massively nerfed from 5/10/15 HP per 5 minutes to 2/3/4.

Returning to shifted spells, Flight now only lasts 10 minutes/level at M, and
still drains magic at GM.  The three Light buff spells have all been nerfed as
well: Day of the Gods and Day of Protection now have lower mastery multipliers
(up to x4 at GM), and Hour of Power has more consistent duration -- the
vanilla MM7 used a very confusing formula that was probably wrong at several
places; now the duration exactly matches the duration of its constituent
spells cast at the equivalent skill level.  Strictly speaking, the two latter
buffs are now no better than casting their spells separately, assuming equal
skill; however, improving their effect requires only putting points in the
school of Light, as opposed to the seven schools that the separate spells are
spread amongst, so casting them can still be advantageous.

Other GM-level changes: GM Feather Fall grants the same bonus as boots of
Leaping, GM Torch Light gives even brighter light than M, and GM Wizard Eye
lasts permanently and can never be dispelled, not even by rest or travel.
If you do want to dispel it for some reason, just cast it again.  By the way,
Immolation now has this feature as well, as leaving it on can be dertimental
around friendly monsters.

Enchant Item is both buffed and nerfed.  On one hand, Master EI now normally
enchants at tlvl3 (down from 4), and GM, at tlvl4 (down from 5).  To enchant
at the vanilla power, you need to cast the spell at noon (from 11:00 to 12:59).
(The noon thing was planned but never implemented in MM6.)  On the other hand,
special (non-numeric) enchantments now scale with spell's tlvl instead of being
stuck at tlvl3, which was likely a bug.  Now you can even get "of the Dragon",
"of Darkness" and other top-tier enchantments, as long as you cast at GM and
at noon.  I also eliminated the exploit that allowed to enchant items of Arms
(or Dodging, or the Fist) higher than normally possible.

Preservation now halves the chance of monsters causing instant death or
eradication.  According to the manual, it was supposed to completely protect
from these conditions, but it was evidently deemed too powerful.  True, but I
think partial resistance is okay.  Makes the spell more useful, too.

Mass Distortion now cannot be entirely resisted, unless the monster is immune
to Magic.  (In vanilla it had a debuff-like resist-to-nullify check AND an
ordinary damage resistance check, and I consider this a bug.)

Sunray has been buffed by allowing it to be cast in some aboveground indoors
locations.  Generaly, if it's not a cave, dungeon, or anywhere in the Pit, you
should be able to cast Sunray while in it (during the daytime, of course).  As
it was in vanilla, the spell just couldn't compete with Meteor Shower and
similar outdoor nukes, so now it hopefully will be more useful.

Finally, Berserk spell gained a new functionality: it can be cast on a PC to
trigger the Insane condition (unless the PC is immune), with all its benefits
and downsides.


=== Item changes ===

The next batch of changes concerns artifacts and various other items.
Firstly, I added new properties to some artifacts both to make the artifacts
more competitive, and to make said properties more common.  Here's the list:

Splitter and Forge Gauntlets grant immunity to Fire.
Twilight grants immunity to Poison (as in the element).
Phynaxian Crown grants immunity to Cold (and some Poison resistance).
Mind's Eye grants immunity to Mind.
Elven Chainmail is now lightweight and adds +5 to Bow skill.
Old Nick has been significantly buffed number-wise.  It also now backstabs
instead of slaying elves.
Corsair also backstabs now.
Kelebrim grants immunity to Dispel Magic.
Hermes' Sandals increase jump height.

Elfbane has been completely replaced with Sacrificial Dagger, a new
Goblin-only artifact that increases maximum SP and has Soul Stealing property.

Morcarack (the Emerald Island dragon) now drops his scales instead of a random
tlvl 6 item.  This means he can no longer be multilooted until the party has a
full set of endgame gear; instead, the scales can later be made into one of
two unique items, plate armor or a shield.  Both grant Fire immunity (and
Morcarack is now also immune to fire, as he should be), and the plate is also
lightweight.  (Please note that the graphics for the new items are VERY
temporary; I'll replace them eventually as soon as I can involve some artist.)

Genie Lamps now give a quintuple bonus (from +5 to +20), and they can only
increase primary stats and resistances, much like in MM6 (except I put
Intellect and Personality on the same month to fit).

Basic-level spellbooks can now be found randomly, FWIW.

Blasters and wands are now equipped in the missile weapon slot (like bows).
Accordingly, they by default will not fire in melee range; if you do want to,
use the quick spell button (or shift-click on a monster) with no quick spell
set.  Also, I replaced wand spells Sparks and Spirit Lash with Slow and
Psychic Shock, as the former two aren't really ranged spells.

On that topic, somewhere in the process of reworking wands I introduced a bug
that often prevents them from making a sound when fired.  I wasn't able to fix
it, unfortunately.  It does not affect gameplay, though.

More wand changes: they no longer disappear when they're out of charges.  You
can see the maximum possible amount of charges the wand can have in its
description.  Wands often spawn not fully charged.  Equipped empty wands are
colored red, as if they were broken.  Wand price also depends on both its
current and maximum charges.  Finally, magic shops can now recharge wands!
Fancier shops can restore more charges, up to 80% of maximum.

The next few tweaks are intended to make melee slightly stronger.  Firstly,
the limit on attack speed has been raised -- it's now 10 attacks per round for
blasters and 5 for any other weapon.  This limit is enforced both in
turn-based and realtime mode.  Next, when using two weapons, the skill of the
weapon in the right hand affects the damage now.  (It used to be the left
hand, which was unfortunate as neither sword nor dagger skill give damage
bonuses to most classes.)  Lastly, most two-handed swords and axes gained a
bonus to damage, which will hopefully make them more competitive.

I also reworked the damage dice of many artifacts to bring them in line with
their base item types.  Charele was a special case, as its improbable 3d9+18
damage was the entire point of the artifact.  Now it has halberd dice and a
more realistic to-hit bonus, but it gets the two-handed damage bonus as an
unique artifact property.  Oh, and Mash is a club instead of a mace now.


=== Other changes ===

Probably the largest diversion in this release was when I decided to rework
the reputation system.  Now, instead of being stored per-map, your reputation
is shared between all locations in the same region.  The main benefit of the
new system is that the reputation given in castles and other indoor locations
is now meaningful.  The reputation penalties given in the dungeons (for theft,
murder etc.) now matter as well.  Additionally, having all of a dozen
different reputation counters made it easier to implement a gamescript command
to change reputation in another region; many quests have been changed to make
use of this.  The only places where reputation doesn't matter are Eeofol and
Shoals, as those regions are unpopulated; it always stays at zero there.

Other reputation changes: almost all quests change it now.  Theft doesn't,
unless you get caught.  Armageddon has a heavy reputation penalty.  Town hall
bounties improve reputation slightly.  Finally, "disreputable" NPCs such as
gypsies and pirates will now only change reputation in their home region, but
this change is permanent.  Rationale: with reputation affecting prices, the
Duper NPC, unlike in MM6, becomes almost useless.  Now, at least, the Duper's
Merchant bonus can be used at full effect if you travel to another region
after hiring them.

Temple donation rewards have been increased in power proportionally to the
donation cost.  They still depend on the day of the week, as well.

Barrels and cauldrons found in some maps give level-dependent bonuses now, up
to +15 at level 99.  Drink now or save for later, your choice!  On that note,
I also changed the barrels in the Walls of Mist so that they refill only once
per year instead of on each visit.  This was exploitable even in vanilla, but
with the above improvement it's just too much.

In vanilla, HP and SP could rarely rise above normal maximum.  It would stay
that way (unless lost or spend) until the first healing effect (including
regeneration), which would reset it to the limit.  That has been redone.  Now
there are more ways to legitimately "overheal" (Shared Life, Souldrinker,
Vampiric and Soul Stealing weapons, and occasionally potions), and healing
won't remove the extra points, but they will quickly dissipate on their own,
reducing by 25% every five minutes.

Monster Dispel Magic has been made less annoying.  In addition to items of
Permanence, it's now possible for party-wide enchantments to resist being
dispelled (a random PC's resistance is checked for each buff).  The base odds
of resisting have been increased fourfold as well, as it's one of the cases
where the game checks primary stats, and such checks were unreasonably
difficult in vanilla.

Cursed PCs have greatly reduced Luck for symmetry with Cursed monsters.

Wishing wells in Bracada and Eeofol are now limited-use (5/day for the former
and 12/month for the latter).  I also slightly changed the possible effects.

There are now exactly three challenges of each type instead of seven +5 ones
and scarcely any others.  Hopefully this will reduce the number of duplicates.

Right-clicking on character stats now displays the base stat value (without
items) and stat rating (which is used for most stat-related bonuses).

Dwarven guards have been put on a diet & exercise regimen.  Now they're much
less likely to get stuck in doorways and block passages with their girth.

Some skill descriptions have been rewritten; notably, spell schools now list
learnable spells.

Rest encounter probabilities are now more varied (used to be 10% almost
everywhere), and you won't be attacked by normally peaceful monsters.  Also,
resting is now safe if all monsters on the map are peaceful -- used to be that
your golem triggered goblin attacks in your castle, which was clearly a bug.

I tweaked shops a little: Tatalian island stores are now open at night, and
Castle Harmondale shops stay open till 23:00.  Also, castle potion shop is
replaced by a magic shop (for convenient selling), and former Nighon magic shop
now sells black potions (more reason to get there early).

Most AOE and shrapnel-like spells now should display a single combined message
for all damaged monsters -- at least in turn-based mode.  It can break if
another spell is cast before the previous one hits.  Similarly, stun,
paralysis, and halved armor messages are combined with the damage messages.
The only weapon that will still produce two messages is Splitter -- the
fireball that it spawns usually overwrites the regular damage message.  I
might fix that later.

Convenience feature: when one of the equipped items is broken, the character's
AC number becomes colored red.  Empty wands do not trigger this, though.

Steadwick ore smiths can now make two-handed weapons, bows, and shields.

Leaving the Grand Temple of the Moon now only deletes the Telekinesis scrolls
that were obtained from the unlimited-use secret panel.

Bookshelves are reworked slightly -- almost any spellbook can be looted, and I
removed the possibility of finding nothing -- if there's anything left, you
will always find it.  On that topic, high Perception affects bookshelves loot.

Many sarcophages in the Barrows have decent items inside, but graverobbing has
consequences!  Again, high Perception helps.

Finally, banks now add a 1% interest each week, like in older games.


=== Bug fixes ===

The more I mess around with MM7's code, the more bugs I discover.  So why not
to fix them!  Eventually most of these should end up in the MM7Patch.

Fix: Gibbet wasn't dealing extra damage to dragons or demons.
Fix: temporary enchantment duration strings weren't localized.
Fix: some quests were giving/reducing reputation four times instead of one.
Fix: leave map event didn't trigger when using stables or a boat.
Fix: faerie pipes award wasn't given to all characters.
Fix: Archibald was supposed to only give you a blaster if you were on a quest
to slay Xenofex.
Fix: white barrels never generated randomly.
Fix: pickpocketing an item produced a wrong message.
Fix: failing to cure insanity still caused weakness.
Fix: failing to raise dead still caused weakness and set HP to 1.
Fix: GM Immutability could protect from execution in castles.
Fix: Archers couldn't use their fire arrows.
Fix: Sacrifice didn't cure conditions or aging.
Fix: Master Healer NPC removed armor skills.
Fix: Lloyd's Beacon was usable in Clanker's Lab before you disabled its
defences.
Fix: buff duration was displayed incorrectly in some circumstances.
Fix: Water Walking used power every 5 minutes instead of 20.
Fix: Control Undead had wrong description.
Fix: "of Feather Falling" enchantment never generated randomly.
Fix: zombification worked incorrectly in v1.0 of my patch.
Fix: some alchemical explosions could break hardened items.
Fix: item bonuses to GM Bow skill didn't improve damage.
Fix: "N/A" string that displays when no bow is equipped wasn't localized.
Fix: The Maze's magic resistance pool could be used repeatedly.
Fix: Seknit Undershadow's tea didn't stack with other Endurance bonuses.
Fix: stealing Mr. Malwick's wand gave it wrong max charges count.
Fix: falling from Celeste was supposed to choose one of 6 different loactions.
Fix: when visiting a region for a first time, weather wasn't initialised.
Fix: Bracada docks teleporter was slightly off-target.
Fix: resting in dark region taverns was often way too long.
Fix: clubs had no base recovery set (it's 100 now).
Fix: Hunter NPC and Hunter PC had the same string resource (which broke some
localizations).
Fix: Castle Harmondale bookshelf checked for School of Sorcery membership.
Fix: some objects in the Grand Temple of the Moon reset after save reload.
Fix: in a couple maps, scripted traps had prohibitive skill requirements.
Fix: drowning dealt fire damage (it's cold now).
Fix: travelling to a new region on foot duplicated ground items.
Fix: some parts of Walls of Mist's keyhole pillars weren't clickable.
Fix: a part of For Riverstride's exit door didn't work.
Fix: Welnin +2 accuracy well wasn't clickable.
Fix: dragons and titans dropped too little gold.
Fix: mace paralysis checked poison resistance (it's physical now).

-------------------------------------------------------------------------------

== Elemental Mod ver. 1.0 ==

=== Main change: revamped, MM6-like elemental system ===

All attacks (spell or otherwise) now belong to one of the following elements:
fire, shock (electricity), cold, poison, physical (e.g. weapon attacks),
mind, magic, holy (undead-targeting attacks), or energy (ignores resistances).

It differs from MM6 in that mind is separate from magic (I think the reason
there were so many magic-immune monsters in MM6 (undead, titans, elementals...)
is that NWC wanted to make them immune to mental attacks, and those were
magic-elemental), and there's a formal element for anti-undead spells.

Spell elements mostly follow MM6, but there are some differences. Here's
the complete list:

All Fire spells, as well as Sunray, attack with fire.
Sparks, Lightning Bolt and Starburst attack with electricity.
Ice Bolt, Ice Blast and Souldrinker* attack with cold.
Poison Spray, Acid Burst and Toxic Cloud attack with poison.
Impolsion, Flying Fist**, Shrapmetal, and most direct-damage Earth spells
are physical attacks.
All Mind spells attack with mind.
Mass Distortion, Spirit Lash, Harm, Prismatic Light, Armageddon
and most debuffs attack with (non-elemental) magic.
Turn Undead***, Destroy Undead and Control Undead attack with holy.
Light Bolt attacks with energy, meaning it can't be resisted.
Dragon Breath attacks with both fire and poison, much like MM8 Darkfire Bolt.
For resisting this spell, the lesser of the two resistances applies.

* I initially intended to make Souldrinker magic-elemental, but there's
already Prismatic Light, and plenty of other magic spells, while cold
was underrepresented.  Hopefully the "sepulchral cold" excuse makes sense.
** This is a change from MM6.  I'm not completely sure the fist is not
a metaphor, but if it's not, the physical damage makes more sense.
*** Turn Undead cannot actually be resisted, but it won't affect
creatures immune to holy (i.e. non-undead).

Poisoned weapons once again attack with poison instead of body.
Blasters attack with energy.

Monster attacks and resistances have been reworked.  Generally,
non-spellcasting monsters are vulnerable to magic; natural, non-poisonous
monsters are vulnerable to poison, fire-based monsters are vulnerable to cold,
and cold-based monsters are vulnerable to fire.  In other cases, poison
resistance was copied from body, magic is approximately light and dark
averaged, and for undead, spirit was converted to holy.  (Non-undead monsters
are immune to holy by definition.)  Monsters that attacked with light
and "earth" now attack with energy; dark attacks are converted to magic.
Water attacks are now either cold or poison.

The six elemental resistance spells have been renamed appropriately,
so, Earth now has Magic Resistance spell, Body has Poison Resistance, etc.
I've managed to draw new buff icons (on the buff panel in the middle-right),
but the spellbook images and spell-casting animation are a bit beyond my skill.
Thankfully, they are mostly vague enough to pass as-is.
I've also renamed Protection from Magic to Immutability to avoid confusion.

There's a couple of other minor changes, such as the new poison resistance
protecting from the poisoned condition, and Phynaxian Crown boosting both
cold and poison resistance.

One notable tweak: base stats (Might, Intellect, etc.) are now more effective
at preventing harmful conditions.  To elaborate: some conditions can be
prevented by having high base stats, and others, by high elemental resistances.
But in the original game even with 500+ in all stats the PC only had
a 2-in-3 chance to resist stat-based conditions, while for resistance-based
ones one only needed 50-60 or so to achieve the same level of protection.
Now, base stats are about 4 times more effective for this purpose.


=== Undead-related changes ===

I've gone on a surprisingly lengthy detour with various undead-related changes
while developing this mod.  In addition to the new holy element, these
mostly concern undead PCs.

The original lich immunities were weird!  The character got 200 body and
mind resistance on lichification, and then any resistance that was 200 or above
was treated as an immunity.  That meant a lich could become immune to
other elements by stacking enough buffs; conversely, if body or mind resistance
was lowered (e.g. by equipping Hareck's Leather), the existing immunity
was lost.

In this mod, liches are immune to poison and mind, always, and
their resistances aren't even checked for this purpose.  In addition,
zombified players are given the same immunities.  The price for this is the
vulnerability to holy attacks.  Some monsters (priests, wizards and angels)
can now cast Turn Undead or Destroy Undead if they detect an undead in your
party.  Turn Undead scares all undead PC, unconditionally; Destroy Undead
deals holy damage to one PC.  Liches have some holy resistance (20 plus any
luck bonus); other zombified PCs are completely vulnerable.

Reanimation spell is also changed: the zombified creature now has the same
changes as the zombified PC (poison and mind immunity, but vulnerable to holy).
Monsters that can cast Destroy Undead may target these monsters as well.

Also, dark temples now don't turn stoned players and liches to zombies.


=== Bug fixes ===

While browsing the disassembly, I also found and fixed a few bugs in the
original game.  I've forwarded those to GrayFace, so hopefully the fixes
will be included in the next version of MM7Patch.  But for now, they'll be
in this mod, because why not.

Fix: "of Assasins" and "of Barbarians" weren't dealing elemental damage.
Fix: Kelebrim wasn't substracting 30 from earth (now poison) resistance.
Fix: Armageddon could not be resisted (now magic resistance applies).
Fix: control undead on the GM level did not work.
Fix: charm on the M level did not work; also, on the GM level it acted
like on E, and on E it acted like on M.
Fix: when monster cast spells on another monster, wrong resistance was checked.
Fix: some pre-placed monsters had spells they couldn't cast.
